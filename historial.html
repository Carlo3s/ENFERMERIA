<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial de Valoraciones</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav>
        <div class="logo">
            <a href="index.html"><img src="logo.png" alt="Logo" id="logo"></a>
        </div>
        <ul>
            <li><a href="index.html">Inicio</a></li>
            <li><a href="historial.html">Historial</a></li>
            <li><a href="acerca.html">Acerca de</a></li>
            <li><a href="contacto.html">Contacto</a></li>
            <li><a href="Valoracion_preguntas.html">Entrevista</a></li>
            <li><a href="ayuda.html">Recursos</a></li>
            <li><button id="logout">Cerrar Sesi贸n</button></li>
        </ul>
    </nav>
    
    <div class="container">
        <h2>Historial de Valoraciones</h2>
        <button onclick="exportarPDF()">Descargar PDF</button>
        <button onclick="exportarJSON()">Descargar JSON</button>
        <div id="historial"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-auth.js";
    
        const firebaseConfig = {
            apiKey: "AIzaSyC2_Bftp6pPmQT41MyYMSc6PiYxEAkz9hs",
            authDomain: "valoracion-enfermeria.firebaseapp.com",
            projectId: "valoracion-enfermeria",
            storageBucket: "valoracion-enfermeria.appspot.com",
            messagingSenderId: "368639381830",
            appId: "1:368639381830:web:253168bfdc4031a9c95547",
            measurementId: "G-YNKHWHMKGB"
        };
    
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
    
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = "login.html";
            }
        });
    
        document.getElementById("logout").addEventListener("click", () => {
            signOut(auth).then(() => {
                window.location.href = "login.html";
            }).catch((error) => {
                console.error("Error al cerrar sesi贸n: ", error);
            });
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            mostrarHistorial();
        });

        function mostrarHistorial() {
            const historialDiv = document.getElementById("historial");
            const historial = JSON.parse(localStorage.getItem("valoraciones")) || [];

            if (historial.length === 0) {
                historialDiv.innerHTML = "<p>No hay valoraciones guardadas.</p>";
                return;
            }

            historial.forEach((item, index) => {
                const div = document.createElement("div");
                div.classList.add("valoracion");
                div.innerHTML = `<h3>Valoraci贸n ${index + 1}</h3>
                                 <p>Paciente: ${item.paciente}</p>
                                 <p>Resultado: <span class="${item.semaforo}">${item.semaforo.toUpperCase()}</span></p>`;
                historialDiv.appendChild(div);
            });
        }

        function exportarPDF() {
            const historial = JSON.parse(localStorage.getItem("valoraciones")) || [];
            let contenido = "Historial de Valoraciones\n\n";
            historial.forEach((item, index) => {
                contenido += `Valoraci贸n ${index + 1}\nPaciente: ${item.paciente}\nResultado: ${item.semaforo.toUpperCase()}\n\n`;
            });
            
            const blob = new Blob([contenido], { type: "application/pdf" });
            const enlace = document.createElement("a");
            enlace.href = URL.createObjectURL(blob);
            enlace.download = "historial_valoraciones.pdf";
            enlace.click();
        }

        function exportarJSON() {
            const historial = JSON.parse(localStorage.getItem("valoraciones")) || [];
            const blob = new Blob([JSON.stringify(historial, null, 2)], { type: "application/json" });
            const enlace = document.createElement("a");
            enlace.href = URL.createObjectURL(blob);
            enlace.download = "historial_valoraciones.json";
            enlace.click();
        }
    </script>
</body>
</html>
